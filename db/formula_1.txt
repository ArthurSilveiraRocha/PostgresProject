-- Arthur Rocha e Kauã Duarte
--------------------------

/*Banco está também em um repositório na nuvem pelo serviço NeonTech
Desnecessário, mas queria saber como funcionava subir um banco na nuvem
A string de conexão é essa: psql 'postgresql://neondb_owner:npg_Rt62oTMLHgnJ@ep-tiny-dawn-adtizesv-pooler.c-2.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require'
Se quiser conferir o repositório Git, por curiosidade, é esse: https://github.com/ArthurSilveiraRocha/PostgresProject.git*/

/*
Legendas
SERIAL -> Incrementa o valor conforme quantia de inserts na tabela
    Ex: Insert 1, id 1, Insert 2, id 2...

NOT NULL -> Não permite que, no insert, o campo seja deixado em branco

UNIQUE -> Não permite que, no insert, seja adicionado outro campo
com conteúdo idêntico

INTERVAL (Tipo de Variável) -> Utilizada para armazenar um período de tempo
    Formato: 'ano', 'mês', 'dia', 'hora', 'minuto', 'segundo'
*/

-- Criação de Tabelas

CREATE TABLE IF NOT EXISTS paises(
    id_pais serial primary key,
    sigla char(3),
    nome varchar(100) not null
);

CREATE TABLE IF NOT EXISTS equipes(
    id_equipe serial primary key,
    nome varchar(100) not null unique,
    id_pais int references paises(id_pais)
);

CREATE TABLE IF NOT EXISTS pilotos(
    id_piloto serial primary key,
    nome varchar(100) not null,
    id_pais int references paises(id_pais)
);

CREATE TABLE IF NOT EXISTS pilotos_equipes (
    id_equipe int references equipes(id_equipe),
    id_piloto int references pilotos(id_piloto),
    data_inicio date not null,
    primary key (id_equipe, id_piloto, data_inicio)   
);

CREATE TABLE IF NOT EXISTS circuitos (
    id_circuito serial primary key,
    nome varchar(100) not null,
    id_pais int references paises(id_pais)
);

CREATE TABLE IF NOT EXISTS corridas(
    id_corrida serial primary key,
    data_corrida date not null,
    nome_corrida varchar(100) not null,
    duracao interval,
    id_circuito int references circuitos(id_circuito),
    nr_voltas int
);

CREATE TABLE IF NOT EXISTS posicoes (
    id_corrida int references corridas(id_corrida),
    posicao_largada int,
    posicao_chegada int,
    tempo interval,
    nr_voltas int,
    pontos int,
    id_piloto int references pilotos(id_piloto),
    id_equipe int references equipes(id_equipe),
    primary key (id_corrida, id_piloto)
);



-- Inserts


-- Tabela Países

-- Inserir na tabela paises: sigla e nome -> valores: 'Sigla', 'Nome'

INSERT INTO paises (sigla, nome) VALUES ('GBR', 'Reino Unido');
INSERT INTO paises (sigla, nome) VALUES ('AUS', 'Austrália');
INSERT INTO paises (sigla, nome) VALUES ('NED', 'Países Baixos');
INSERT INTO paises (sigla, nome) VALUES ('ITA', 'Itália');
INSERT INTO paises (sigla, nome) VALUES ('MON', 'Mônaco');
INSERT INTO paises (sigla, nome) VALUES ('ESP', 'Espanha');
INSERT INTO paises (sigla, nome) VALUES ('CAN', 'Canadá');
INSERT INTO paises (sigla, nome) VALUES ('DEU', 'Alemanha');
INSERT INTO paises (sigla, nome) VALUES ('FRA', 'França');
INSERT INTO paises (sigla, nome) VALUES ('BRA', 'Brasil');
INSERT INTO paises (sigla, nome) VALUES ('NZL', 'Nova Zelândia');
INSERT INTO paises (sigla, nome) VALUES ('THA', 'Tailândia');
INSERT INTO paises (sigla, nome) VALUES ('JPN', 'Japão');
INSERT INTO paises (sigla, nome) VALUES ('CHE', 'Suíça');
INSERT INTO paises (sigla, nome) VALUES ('USA', 'Estados Unidos');
INSERT INTO paises (sigla, nome) VALUES ('AUT', 'Áustria');
INSERT INTO paises (sigla, nome) VALUES ('CHN', 'China');



-- Tabela Equipes

-- Inserir na tabela equipes: nome, id_pais -> valores: nome, procura pelo id_pais da tabela países onde sigla = 'país da equipe'

INSERT INTO equipes (nome, id_pais) VALUES ('McLaren', (SELECT id_pais FROM paises WHERE sigla = 'GBR'));
INSERT INTO equipes (nome, id_pais) VALUES ('Red Bull Racing', (SELECT id_pais FROM paises WHERE sigla = 'AUT'));
INSERT INTO equipes (nome, id_pais) VALUES ('Mercedes', (SELECT id_pais FROM paises WHERE sigla = 'DEU'));
INSERT INTO equipes (nome, id_pais) VALUES ('Ferrari', (SELECT id_pais FROM paises WHERE sigla = 'ITA'));
INSERT INTO equipes (nome, id_pais) VALUES ('Aston Martin', (SELECT id_pais FROM paises WHERE sigla = 'GBR'));
INSERT INTO equipes (nome, id_pais) VALUES ('Alpine', (SELECT id_pais FROM paises WHERE sigla = 'FRA'));
INSERT INTO equipes (nome, id_pais) VALUES ('Williams', (SELECT id_pais FROM paises WHERE sigla = 'GBR'));
INSERT INTO equipes (nome, id_pais) VALUES ('RB', (SELECT id_pais FROM paises WHERE sigla = 'ITA'));
INSERT INTO equipes (nome, id_pais) VALUES ('Haas', (SELECT id_pais FROM paises WHERE sigla = 'USA'));
INSERT INTO equipes (nome, id_pais) VALUES ('Sauber', (SELECT id_pais FROM paises WHERE sigla = 'CHE'));



-- Tabela Pilotos

-- Inserir na tabela pilotos: nome, id_pais -> valores: nome, procura pelo id_pais da tabela países onde sigla = 'país do piloto'

INSERT INTO pilotos (nome, id_pais) VALUES ('Lando Norris', (SELECT id_pais FROM paises WHERE sigla = 'GBR'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Oscar Piastri', (SELECT id_pais FROM paises WHERE sigla = 'AUS'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Max Verstappen', (SELECT id_pais FROM paises WHERE sigla = 'NED'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Liam Lawson', (SELECT id_pais FROM paises WHERE sigla = 'NZL'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Charles Leclerc', (SELECT id_pais FROM paises WHERE sigla = 'MON'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Lewis Hamilton', (SELECT id_pais FROM paises WHERE sigla = 'GBR'));
INSERT INTO pilotos (nome, id_pais) VALUES ('George Russell', (SELECT id_pais FROM paises WHERE sigla = 'GBR'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Andrea Kimi Antonelli', (SELECT id_pais FROM paises WHERE sigla = 'ITA'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Fernando Alonso', (SELECT id_pais FROM paises WHERE sigla = 'ESP'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Lance Stroll', (SELECT id_pais FROM paises WHERE sigla = 'CAN'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Nico Hulkenberg', (SELECT id_pais FROM paises WHERE sigla = 'DEU'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Gabriel Bortoleto', (SELECT id_pais FROM paises WHERE sigla = 'BRA'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Pierre Gasly', (SELECT id_pais FROM paises WHERE sigla = 'FRA'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Jack Doohan', (SELECT id_pais FROM paises WHERE sigla = 'AUS'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Oliver Bearman', (SELECT id_pais FROM paises WHERE sigla = 'GBR'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Esteban Ocon', (SELECT id_pais FROM paises WHERE sigla = 'FRA'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Yuki Tsunoda', (SELECT id_pais FROM paises WHERE sigla = 'JPN'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Isack Hadjar', (SELECT id_pais FROM paises WHERE sigla = 'FRA'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Alexander Albon', (SELECT id_pais FROM paises WHERE sigla = 'THA'));
INSERT INTO pilotos (nome, id_pais) VALUES ('Carlos Sainz', (SELECT id_pais FROM paises WHERE sigla = 'ESP'));



-- Tabela Pilotos_Equipes

-- Inserir na tabela pilotos_equipes: id_equipe, id_piloto, data_inicio -> valores:
--   -> procura pelo id_equipe na tabela equipes onde nome = 'Nome da equipe do piloto'
--   -> procura pelo id_piloto na tabela pilotos onde nome = 'Nome do piloto da equipe'
--   -> data_inicio = jan/01/2025

INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'McLaren'), (SELECT id_piloto FROM pilotos WHERE nome = 'Lando Norris'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'McLaren'), (SELECT id_piloto FROM pilotos WHERE nome = 'Oscar Piastri'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Red Bull Racing'), (SELECT id_piloto FROM pilotos WHERE nome = 'Max Verstappen'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Red Bull Racing'), (SELECT id_piloto FROM pilotos WHERE nome = 'Liam Lawson'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Mercedes'), (SELECT id_piloto FROM pilotos WHERE nome = 'George Russell'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Mercedes'), (SELECT id_piloto FROM pilotos WHERE nome = 'Andrea Kimi Antonelli'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Ferrari'), (SELECT id_piloto FROM pilotos WHERE nome = 'Charles Leclerc'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Ferrari'), (SELECT id_piloto FROM pilotos WHERE nome = 'Lewis Hamilton'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Aston Martin'), (SELECT id_piloto FROM pilotos WHERE nome = 'Fernando Alonso'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Aston Martin'), (SELECT id_piloto FROM pilotos WHERE nome = 'Lance Stroll'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Alpine'), (SELECT id_piloto FROM pilotos WHERE nome = 'Pierre Gasly'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Alpine'), (SELECT id_piloto FROM pilotos WHERE nome = 'Jack Doohan'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Williams'), (SELECT id_piloto FROM pilotos WHERE nome = 'Alexander Albon'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Williams'), (SELECT id_piloto FROM pilotos WHERE nome = 'Carlos Sainz'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'RB'), (SELECT id_piloto FROM pilotos WHERE nome = 'Yuki Tsunoda'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'RB'), (SELECT id_piloto FROM pilotos WHERE nome = 'Isack Hadjar'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Haas'), (SELECT id_piloto FROM pilotos WHERE nome = 'Oliver Bearman'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Haas'), (SELECT id_piloto FROM pilotos WHERE nome = 'Esteban Ocon'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Sauber'), (SELECT id_piloto FROM pilotos WHERE nome = 'Nico Hulkenberg'), '2025-01-01');
INSERT INTO pilotos_equipes (id_equipe, id_piloto, data_inicio) VALUES ((SELECT id_equipe FROM equipes WHERE nome = 'Sauber'), (SELECT id_piloto FROM pilotos WHERE nome = 'Gabriel Bortoleto'), '2025-01-01');



-- Tabela Circuitos

-- Inserir na tabela circuitos: nome, id_pais -> valores, procura id_pais na tabela paises onde sigla = 'País do circuito'

INSERT INTO circuitos (nome, id_pais) VALUES ('Circuito do Grande Prêmio de Melbourne', (SELECT id_pais FROM paises WHERE sigla = 'AUS'));
INSERT INTO circuitos (nome, id_pais) VALUES ('Circuito Internacional de Xangai', (SELECT id_pais FROM paises WHERE sigla = 'CHN'));



-- Tabela Corridas

-- Inserir na tabela corridas: data_corrida, nome_corrida, duracao, id_circuito, nr_voltas -> valores
--    -> data da corrida, nome da corrida, duração exata da corrida, procura id_circuito na tabela circuitos onde nome do circuito = "Nome do circuito daquela corrida"

INSERT INTO corridas (data_corrida, nome_corrida, duracao, id_circuito, nr_voltas) VALUES ('2025-03-16', 'Grande Prêmio da Austrália', '01:42:06.304', (SELECT id_circuito FROM circuitos WHERE nome = 'Circuito do Grande Prêmio de Melbourne'), 57);
INSERT INTO corridas (data_corrida, nome_corrida, duracao, id_circuito, nr_voltas) VALUES ('2025-03-23', 'Grande Prêmio da China', '01:30:55.026', (SELECT id_circuito FROM circuitos WHERE nome = 'Circuito Internacional de Xangai'), 56);


-- Tabela Posições

-- 20 pilotos, 2 corridas = 40 inserts

-- Inserir na tabela posicoes: id_corrida, posicao_largada, posicao_chegada, tempo, nr_voltas, pontos, id_piloto, id_equipe -> valores
--    -> procura id_corrida na tabela corridas onde o nome da corrida = 'Nome da corrida'
--    -> posicao do piloto no inicio da corrida, posicao do piloto no fim da corrida
--    -> tempo do piloto naquela corrida
--          pilotos que tiveram o tempo do piloto na corrida deixado em branco tiveram não terminaram a corrida (DNF)
--    -> numero de voltas daquela corrida
--    -> pontuação zerada pois será preenchida por procedure
--    -> procura id_piloto na tabela pilotos onde o nome do piloto = 'Nome do piloto participante da corrida'
--    -> procura id_equipe na tabela equipes onde o nome da equipe = 'Nome da equipe do piloto participante'

-- Grande Prêmio da Austrália

INSERT INTO posicoes VALUES
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 3, 1, '01:42:06.304', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Lando Norris'), (SELECT id_equipe FROM equipes WHERE nome = 'McLaren')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 4, 2, '01:42:07.200', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Max Verstappen'), (SELECT id_equipe FROM equipes WHERE nome = 'Red Bull Racing')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 2, 3, '01:42:14.785', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'George Russell'), (SELECT id_equipe FROM equipes WHERE nome = 'Mercedes')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 8, 4, '01:42:16.439', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Andrea Kimi Antonelli'), (SELECT id_equipe FROM equipes WHERE nome = 'Mercedes')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 10, 5, '01:42:19.077', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Alexander Albon'), (SELECT id_equipe FROM equipes WHERE nome = 'Williams')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 14, 6, '01:42:23.717', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Lance Stroll'), (SELECT id_equipe FROM equipes WHERE nome = 'Aston Martin')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 12, 7, '01:42:24.727', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Nico Hulkenberg'), (SELECT id_equipe FROM equipes WHERE nome = 'Sauber')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 6, 8, '01:42:26.130', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Charles Leclerc'), (SELECT id_equipe FROM equipes WHERE nome = 'Ferrari')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 1, 9, '01:42:26.752', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Oscar Piastri'), (SELECT id_equipe FROM equipes WHERE nome = 'McLaren')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 5, 10, '01:42:28.777', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Lewis Hamilton'), (SELECT id_equipe FROM equipes WHERE nome = 'Ferrari')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 16, 11, '01:42:32.806', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Pierre Gasly'), (SELECT id_equipe FROM equipes WHERE nome = 'Alpine')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 7, 12, '01:42:36.188', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Yuki Tsunoda'), (SELECT id_equipe FROM equipes WHERE nome = 'RB')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 11, 13, '01:42:39.465', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Esteban Ocon'), (SELECT id_equipe FROM equipes WHERE nome = 'Haas')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 17, 14, '01:42:46.655', 57, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Oliver Bearman'), (SELECT id_equipe FROM equipes WHERE nome = 'Haas')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 20, 15, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Liam Lawson'), (SELECT id_equipe FROM equipes WHERE nome = 'Red Bull Racing')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 19, 16, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Gabriel Bortoleto'), (SELECT id_equipe FROM equipes WHERE nome = 'Sauber')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 13, 17, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Fernando Alonso'), (SELECT id_equipe FROM equipes WHERE nome = 'Aston Martin')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 15, 18, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Carlos Sainz'), (SELECT id_equipe FROM equipes WHERE nome = 'Williams')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 18, 19, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Jack Doohan'), (SELECT id_equipe FROM equipes WHERE nome = 'Alpine')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da Austrália'), 9, 20, NULL, 0, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Isack Hadjar'), (SELECT id_equipe FROM equipes WHERE nome = 'RB'));


-- Grande Prêmio da China

INSERT INTO posicoes VALUES
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 2, 1, '01:30:55.026', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Oscar Piastri'), (SELECT id_equipe FROM equipes WHERE nome = 'McLaren')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 1, 2, '01:31:04.774', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Lando Norris'), (SELECT id_equipe FROM equipes WHERE nome = 'McLaren')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 4, 3, '01:31:06.123', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'George Russell'), (SELECT id_equipe FROM equipes WHERE nome = 'Mercedes')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 3, 4, '01:31:11.682', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Max Verstappen'), (SELECT id_equipe FROM equipes WHERE nome = 'Red Bull Racing')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 9, 5, '01:31:45.000', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Esteban Ocon'), (SELECT id_equipe FROM equipes WHERE nome = 'Haas')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 16, 6, '01:31:48.774', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Andrea Kimi Antonelli'), (SELECT id_equipe FROM equipes WHERE nome = 'Mercedes')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 10, 7, '01:31:51.347', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Alexander Albon'), (SELECT id_equipe FROM equipes WHERE nome = 'Williams')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 20, 8, '01:31:56.329', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Oliver Bearman'), (SELECT id_equipe FROM equipes WHERE nome = 'Haas')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 13, 9, '01:32:05.230', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Lance Stroll'), (SELECT id_equipe FROM equipes WHERE nome = 'Aston Martin')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 10, 10, '01:32:11.413', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Carlos Sainz'), (SELECT id_equipe FROM equipes WHERE nome = 'Williams')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 11, 11, '01:32:13.901', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Isack Hadjar'), (SELECT id_equipe FROM equipes WHERE nome = 'RB')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 18, 12, '01:32:16.173', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Liam Lawson'), (SELECT id_equipe FROM equipes WHERE nome = 'Red Bull Racing')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 14, 13, '01:32:23.427', 56, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Jack Doohan'), (SELECT id_equipe FROM equipes WHERE nome = 'Alpine')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 19, 14, NULL, 55, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Gabriel Bortoleto'), (SELECT id_equipe FROM equipes WHERE nome = 'Sauber')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 17, 15, NULL, 55, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Nico Hulkenberg'), (SELECT id_equipe FROM equipes WHERE nome = 'Sauber')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 5, 16, NULL, 55, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Yuki Tsunoda'), (SELECT id_equipe FROM equipes WHERE nome = 'RB')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 12, 17, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Fernando Alonso'), (SELECT id_equipe FROM equipes WHERE nome = 'Aston Martin')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 7, 18, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Charles Leclerc'), (SELECT id_equipe FROM equipes WHERE nome = 'Ferrari')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 8, 19, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Lewis Hamilton'), (SELECT id_equipe FROM equipes WHERE nome = 'Ferrari')),
((SELECT id_corrida FROM corridas WHERE nome_corrida = 'Grande Prêmio da China'), 15, 20, NULL, 50, 0, (SELECT id_piloto FROM pilotos WHERE nome = 'Pierre Gasly'), (SELECT id_equipe FROM equipes WHERE nome = 'Alpine'));




-- Funções

-- Função para cálculo dos pontos da tabela posicoes


-- Cria ou substitui a função calcular_pontos, usando o parâmetro 'posicao'
create or replace function calcular_pontos(posicao int)
-- Inicia a estrutura plpgsql e indica que vai retornar um número inteiro
returns int as $$
begin
-- Cria um state case usando o parâmetro da função para retornar os pontos baseado na posição do piloto na corrida
    case posicao
        when 1 then return 25;
        when 2 then return 18;
        when 3 then return 15;
        when 4 then return 12;
        when 5 then return 10;
        when 6 then return 8;
        when 7 then return 6;
        when 8 then return 4;
        when 9 then return 2;
        when 10 then return 1;
        else return 0;
    -- Encerra o state case
    end case;
-- Encerra a estrutura plpgsql
end;
$$ language plpgsql;

-- Atualiza a coluna 'pontos' da tabela 'posicoes', definindo os novos valores
update posicoes
-- Utiliza a função de cálculo de pontos com o parâmetro da coluna 'posicao_chegada', já preenchida na tabela
set pontos = calcular_pontos(posicao_chegada);


-- Trigger para bloquear criação de equipes duplicadas na tabela equipes

-- Cria ou substituí a função de verificação de equipe
create or replace function equipe_existe()
-- Inicia a estrutura plpgpsql e indica que irá retornar uma trigger
returns trigger as $$
begin
-- Inicia condicional, utilizar NEW para representar o novo input
-- na coluna nome e compara com o que já existe
    if exists (select 1 from equipes where nome = NEW.nome) then
    -- Mostra um texto indicando que a linha que seria criada já existe
        raise exception 'Equipe "%" já existe', NEW.nome;
    -- Encerra a condicional
    end if;
    /* Não bloqueia exatamente que outra linha igual seja criada, mas RETURN NEW
    faz com que a linha antiga seja subtituída pela linha idêntica criada
    portanto, não altera o que foi inserido anteriormente, pois é idêntico ao que já constava na linha */
    return NEW;
-- Encerra a estrutura plpgsql
end;
$$ language plpgsql;

-- Cria a trigger para puxar a função que verifica se a equipe existe
create trigger trg_equipe_existe
-- Define condicional para a trigger
before insert on equipes
-- Inicia estrutura de repetição para passar por cada linha dos inserts
for each row
-- Executa a função criada posteriormente, que verifica se a linha já existe e,
-- caso já existir, vai impedir que seja criada uma duplicata.
execute function equipe_existe()
